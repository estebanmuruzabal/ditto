{"ast":null,"code":"var __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { useContext, useState } from 'react';\nimport * as Yup from 'yup';\nimport { withFormik, Form } from 'formik';\nimport { closeModal } from '@redq/reuse-modal';\nimport { Button } from 'components/button/button';\nimport { useMutation } from '@apollo/react-hooks';\nimport { ButtonsContainer, DayContainer, Heading, ListDes, ListItem, ListTitle, PlantsSensorContainer, Text, WeekContainer } from './add-schedule-card.style';\nimport { ProfileContext } from 'contexts/profile/profile.context';\nimport { FormattedMessage, useIntl } from 'react-intl';\nimport Loader from 'components/loader/loader';\nimport TimePicker from 'react-time-picker';\nimport { WeekDays } from 'utils/constant';\nimport { UPDATE_SETTING } from 'graphql/query/plants.query';\nimport { getDayShortName } from 'utils/sensorUtils';\nimport Switch from 'components/switch/switch'; // Shape of form values\n\n// Wrap our form with the using withFormik HoC\nconst FormEnhancer = withFormik({\n  // Transform outer props into form values\n  mapPropsToValues: props => {\n    return {\n      id: props.item.id || null,\n      name: props.item.name || '',\n      info: props.item.info || ''\n    };\n  },\n  validationSchema: Yup.object().shape({\n    name: Yup.string().required('Requerido!'),\n    info: Yup.string().required('Requerido')\n  }),\n  handleSubmit: values => {// do submitting things\n  }\n});\n\nconst AddTimeSchedule = props => {\n  var _currentSchedule$star, _currentSchedule$endT, _currentSchedule$days;\n\n  const {\n    item,\n    values\n  } = props;\n  const addressValue = {\n    id: values.id,\n    type: 'secondary',\n    name: values.name,\n    info: values.info\n  };\n  const settingIndex = item.plant.sensors.findIndex(module => module.settingType === item.settingType);\n  const currentSchedule = item.plant.sensors[settingIndex].scheduledOnTimes[item === null || item === void 0 ? void 0 : item.schedulePosition];\n  const {\n    state,\n    dispatch\n  } = useContext(ProfileContext);\n  const {\n    0: loading,\n    1: setLoading\n  } = useState(false);\n  const {\n    0: isSmartLightingOn,\n    1: setSmartLighting\n  } = useState(currentSchedule === null || currentSchedule === void 0 ? void 0 : currentSchedule.smartLight);\n  const {\n    0: isEnabled,\n    1: setIsEnabled\n  } = useState(currentSchedule === null || currentSchedule === void 0 ? void 0 : currentSchedule.enabled);\n  const {\n    0: startTime,\n    1: startTimeChange\n  } = useState((currentSchedule === null || currentSchedule === void 0 ? void 0 : (_currentSchedule$star = currentSchedule.startTime) === null || _currentSchedule$star === void 0 ? void 0 : _currentSchedule$star.length) > 0 ? currentSchedule.startTime : '00:00');\n  const {\n    0: endTime,\n    1: endTimeChange\n  } = useState((currentSchedule === null || currentSchedule === void 0 ? void 0 : (_currentSchedule$endT = currentSchedule.endTime) === null || _currentSchedule$endT === void 0 ? void 0 : _currentSchedule$endT.length) > 0 ? currentSchedule.endTime : '23:59');\n  const {\n    0: daysSelected,\n    1: setDaysSelected\n  } = useState((currentSchedule === null || currentSchedule === void 0 ? void 0 : (_currentSchedule$days = currentSchedule.daysToRepeat) === null || _currentSchedule$days === void 0 ? void 0 : _currentSchedule$days.length) >= 0 ? currentSchedule.daysToRepeat : []);\n  const [updateSetting] = useMutation(UPDATE_SETTING);\n  const intl = useIntl();\n\n  const dispatchSettingSave = (plant, sensorSetting, settingType) => {\n    updateSetting({\n      variables: {\n        id: item.id,\n        plantId: plant.plantId,\n        input: _objectSpread(_objectSpread({}, sensorSetting), {}, {\n          settingType: settingType\n        })\n      }\n    });\n  };\n\n  const handleSubmit = async () => {\n    const newSchedule = {\n      daysToRepeat: daysSelected,\n      startTime,\n      endTime,\n      enabled: isEnabled,\n      smartLight: isSmartLightingOn\n    };\n    setLoading(true); // here we just check and make it an array in case its not\n\n    const settingIndex = item.plant.sensors.findIndex(module => module.settingType === item.settingType);\n    const setting = item.plant.sensors[settingIndex]; // setting.scheduledOnTimes = setting?.scheduledOnTimes?.length >= 0 ? setting?.scheduledOnTimes : [];\n\n    if (currentSchedule && (item === null || item === void 0 ? void 0 : item.schedulePosition) >= 0) {\n      setting.scheduledOnTimes[item === null || item === void 0 ? void 0 : item.schedulePosition] = newSchedule;\n    } else {\n      setting.scheduledOnTimes.push(newSchedule);\n    }\n\n    dispatch({\n      type: 'UPDATE_MODULE',\n      payload: {\n        setting,\n        plantId: item.plant.plantId,\n        settingIndex\n      }\n    });\n    dispatchSettingSave(item.plant, setting, item.settingType);\n    closeModal();\n    setLoading(false);\n  };\n\n  const handleDaysAddition = day => {\n    const dayIndex = daysSelected.indexOf(day);\n    let newDaysSelectedArray = daysSelected;\n    dayIndex >= 0 ? newDaysSelectedArray.splice(dayIndex, 1) : newDaysSelectedArray.push(day);\n    setDaysSelected(newDaysSelectedArray);\n  };\n\n  return __jsx(Form, null, __jsx(PlantsSensorContainer, null, __jsx(Heading, null, __jsx(Heading, null, intl.formatMessage({\n    id: currentSchedule ? 'editTimeScheduleId' : 'addTimeScheduleId',\n    defaultMessage: 'addTimeScheduleId'\n  }))), __jsx(ListItem, null, __jsx(ListTitle, null, __jsx(Text, {\n    bold: true\n  }, __jsx(FormattedMessage, {\n    id: \"startTimeId\",\n    defaultMessage: \"startTimeId\"\n  }))), __jsx(ListDes, null, __jsx(TimePicker, {\n    onChange: e => startTimeChange(e),\n    value: startTime,\n    disableClock: true\n  }))), __jsx(ListItem, null, __jsx(ListTitle, null, __jsx(Text, {\n    bold: true\n  }, __jsx(FormattedMessage, {\n    id: \"endTimeId\",\n    defaultMessage: \"endTimeId\"\n  }))), __jsx(ListDes, null, __jsx(TimePicker, {\n    onChange: e => endTimeChange(e),\n    value: endTime,\n    disableClock: true\n  }))), __jsx(ListItem, {\n    style: {\n      justifyContent: 'flex-start'\n    }\n  }, __jsx(ListTitle, null, __jsx(Text, {\n    bold: true\n  }, __jsx(FormattedMessage, {\n    id: \"smartLightingLabelId\",\n    defaultMessage: \"smartLightingLabelId\"\n  }))), __jsx(ListDes, {\n    style: {\n      marginLeft: '30px'\n    }\n  }, __jsx(Switch, {\n    disabled: false,\n    checked: isSmartLightingOn,\n    labelPosition: 'right',\n    onUpdate: () => setSmartLighting(!isSmartLightingOn)\n  }))), __jsx(ListItem, {\n    style: {\n      justifyContent: 'flex-start'\n    }\n  }, __jsx(ListTitle, null, __jsx(Text, {\n    bold: true\n  }, __jsx(FormattedMessage, {\n    id: \"disabledLabelId\",\n    defaultMessage: \"disabledLabelId\"\n  }))), __jsx(ListDes, {\n    style: {\n      marginLeft: '30px'\n    }\n  }, __jsx(Switch, {\n    disabled: false,\n    checked: !isEnabled,\n    labelPosition: 'right',\n    onUpdate: () => setIsEnabled(!isEnabled)\n  }))), __jsx(WeekContainer, null, WeekDays.map(day => {\n    return __jsx(DayContainer, {\n      key: day + '-day-container',\n      style: {\n        backgroundColor: daysSelected.indexOf(day) >= 0 ? '#b99c9c' : 'transparent'\n      },\n      onClick: () => handleDaysAddition(day)\n    }, getDayShortName(day));\n  })), __jsx(ButtonsContainer, null, __jsx(Button, {\n    onClick: handleSubmit,\n    type: \"submit\" // style={{ width: '100%', height: '44px', marginTop: '200px' }}\n    ,\n    loader: __jsx(Loader, null),\n    isDisabled: loading,\n    isLoading: loading\n  }, __jsx(FormattedMessage, {\n    id: currentSchedule ? \"editTimeFrameId\" : \"addTimeFrameId\",\n    defaultMessage: \"addTimeFrameId\"\n  })), __jsx(Button, {\n    onClick: () => closeModal(),\n    style: {\n      marginLeft: '20px'\n    },\n    loader: __jsx(Loader, null),\n    isDisabled: loading,\n    isLoading: loading\n  }, __jsx(FormattedMessage, {\n    id: \"cancelTimeFrameId\",\n    defaultMessage: \"cancelTimeFrameId\"\n  })))));\n};\n\nexport default FormEnhancer(AddTimeSchedule);","map":null,"metadata":{},"sourceType":"module"}